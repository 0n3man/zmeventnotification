

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FAQ &mdash; Event Notification Server  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Event Notification Server  documentation" href="../index.html"/>
        <link rel="next" title="For Developers writing their own consumers" href="developers.html"/>
        <link rel="prev" title="Breaking Changes" href="breaking.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Event Notification Server
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks.html">Machine Learning Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="breaking.html">Breaking Changes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#machine-learning-mmm-machine-learning">Machine Learning! Mmm..Machine Learning!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-it">What is it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-do-we-need-it">Why do we need it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#is-this-officially-developed-by-zm-developers">Is this officially developed by ZM developers?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-can-i-use-this-with-node-red-or-home-assistant">How can I use this with Node-Red or Home Assistant?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disabling-security">Disabling security</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-safely-upgrade-zmeventnotification-to-new-versions">How do I safely upgrade zmeventnotification to new versions?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-the-notification-server">Configuring the notification server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#understanding-zmeventnotification-configuration">Understanding zmeventnotification configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-the-hook-section">What is the hook section ?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting-common-situations">Troubleshooting common situations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#picture-notifications-don-t-show-images">Picture notifications don’t show images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#secure-mode-just-doesn-t-work-wss-ws-works">Secure mode just doesn’t work (WSS) - WS works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-m-not-receiving-push-notifications-in-zmninja">I’m not receiving push notifications in zmNinja</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-m-getting-multiple-notifications-for-the-same-event">I’m getting multiple notifications for the same event</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-server-runs-fine-when-manually-executed-but-fails-when-run-in-daemon-mode-started-by-zmdc-pl">The server runs fine when manually executed, but fails when run in daemon mode (started by zmdc.pl)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#when-you-run-zmeventnotifiation-pl-manually-you-get-an-error-saying-port-already-in-use-or-cannot-bind-to-port-or-something-like-that">When you run zmeventnotifiation.pl manually, you get an error saying ‘port already in use’ or ‘cannot bind to port’ or something like that</a></li>
<li class="toctree-l3"><a class="reference internal" href="#great-krypton-i-just-upgraded-zoneminder-and-i-m-not-getting-push-anymore">Great Krypton! I just upgraded ZoneMinder and I’m not getting push anymore!</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-disable-secure-wss-mode">How do I disable secure (WSS) mode?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-and-reporting-problems">Debugging and reporting problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-scalable-is-it">How scalable is it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#brickbats">Brickbats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">For Developers writing their own consumers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Event Notification Server</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>FAQ</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/guides/faq.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="faq">
<h1>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h1>
<div class="section" id="machine-learning-mmm-machine-learning">
<h2>Machine Learning! Mmm..Machine Learning!<a class="headerlink" href="#machine-learning-mmm-machine-learning" title="Permalink to this headline">¶</a></h2>
<p>Easy. You will first have to read this document to correctly install
this server along with zoneminder. Once it works well, you can explore
how to enable Machine Learning based object detection that can be used
along with ZoneMinder alarms. If you already have this server figured
out, you can skip directly to the machine learning part (<a class="reference internal" href="hooks.html"><span class="doc">Machine Learning Hooks</span></a>)</p>
</div>
<div class="section" id="what-is-it">
<h2>What is it?<a class="headerlink" href="#what-is-it" title="Permalink to this headline">¶</a></h2>
<p>A WSS (Secure Web Sockets) and/or MQTT based event notification server
that broadcasts new events to any authenticated listeners. (As of 0.6,
it also includes a non secure websocket option, if that’s how you want
to run it)</p>
</div>
<div class="section" id="why-do-we-need-it">
<h2>Why do we need it?<a class="headerlink" href="#why-do-we-need-it" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The only way ZoneMinder sends out event notifications via event
filters - this is too slow</li>
<li>People developing extensions to work with ZoneMinder for Home
Automation needs will benefit from a clean interface</li>
<li>Receivers don’t poll. They keep a web socket open and when there are
events, they get a notification</li>
<li>Supports WebSockets, MQTT and Apple/Android push notification
transports</li>
<li>Offers an authentication layer</li>
<li>Allows you to integrate custom hooks that can decide if an alarm
needs to be sent out or not (an example of how this can be used for
person detection is provided)</li>
</ul>
</div>
<div class="section" id="is-this-officially-developed-by-zm-developers">
<h2>Is this officially developed by ZM developers?<a class="headerlink" href="#is-this-officially-developed-by-zm-developers" title="Permalink to this headline">¶</a></h2>
<p>No. I developed it for zmNinja, but you can use it with your own
consumer.</p>
</div>
<div class="section" id="how-can-i-use-this-with-node-red-or-home-assistant">
<h2>How can I use this with Node-Red or Home Assistant?<a class="headerlink" href="#how-can-i-use-this-with-node-red-or-home-assistant" title="Permalink to this headline">¶</a></h2>
<p>As of version 1.1, the event server also supports MQTT (Contributed by
[&#64;vajonam](<a class="reference external" href="https://github.com/vajonam">https://github.com/vajonam</a>)). zmeventnotification server can
be configured to broadcast on a topic called
<code class="docutils literal"><span class="pre">/zoneminder/&lt;monitor-id&gt;</span></code> which can then be consumed by Home
Assistant or Node-Red.</p>
<p>To enable this, set <code class="docutils literal"><span class="pre">enable</span> <span class="pre">=</span> <span class="pre">1</span></code> under the <code class="docutils literal"><span class="pre">[mqtt]</span></code> section and
specify the <code class="docutils literal"><span class="pre">server</span></code> to broadcast to.</p>
<p>You will also need to install the following module for this work</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">perl</span> <span class="o">-</span><span class="n">MCPAN</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;install Net::MQTT::Simple&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="disabling-security">
<h2>Disabling security<a class="headerlink" href="#disabling-security" title="Permalink to this headline">¶</a></h2>
<p>While I don’t recommend either, several users seem to be interested in
the following</p>
<ul class="simple">
<li>To run the eventserver on Websockets and not Secure Websockets, use
<code class="docutils literal"><span class="pre">enable</span> <span class="pre">=</span> <span class="pre">0</span></code> in the <code class="docutils literal"><span class="pre">[ssl]</span></code> section of the configuration file.</li>
<li>To disable ZM Auth checking (be careful, anyone can get all your data
INCLUDING passwords for ZoneMinder monitors if you open it up to the
Internet) use <code class="docutils literal"><span class="pre">enable</span> <span class="pre">=</span> <span class="pre">0</span></code> in the <code class="docutils literal"><span class="pre">[auth]</span></code> section of the
configuration file.</li>
</ul>
</div>
<div class="section" id="how-do-i-safely-upgrade-zmeventnotification-to-new-versions">
<h2>How do I safely upgrade zmeventnotification to new versions?<a class="headerlink" href="#how-do-i-safely-upgrade-zmeventnotification-to-new-versions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">zmdc</span><span class="o">.</span><span class="n">pl</span> <span class="n">stop</span> <span class="n">zmeventnotification</span><span class="o">.</span><span class="n">pl</span>
</pre></div>
</div>
<p>Now copy the new zmeventnotification.pl to the right place (usually
<code class="docutils literal"><span class="pre">/usr/bin</span></code>) If you need to, copy the new zmeventnotification.ini to
the right place (usually <code class="docutils literal"><span class="pre">/etc/zm</span></code>) (Note: this will replace your old
config file and you shouldn’t need to do this)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">zmdc</span><span class="o">.</span><span class="n">pl</span> <span class="n">start</span> <span class="n">zmeventnotification</span><span class="o">.</span><span class="n">pl</span>
</pre></div>
</div>
<p>Make sure you look at the syslogs to make sure its started properly</p>
</div>
<div class="section" id="configuring-the-notification-server">
<h2>Configuring the notification server<a class="headerlink" href="#configuring-the-notification-server" title="Permalink to this headline">¶</a></h2>
<div class="section" id="understanding-zmeventnotification-configuration">
<h3>Understanding zmeventnotification configuration<a class="headerlink" href="#understanding-zmeventnotification-configuration" title="Permalink to this headline">¶</a></h3>
<p>Starting v1.0, [&#64;synthead](<a class="reference external" href="https://github.com/synthead">https://github.com/synthead</a>) reworked the
configuration as follows:</p>
<ul class="simple">
<li>If you just run <code class="docutils literal"><span class="pre">zmeventnotification.pl</span></code> it will try and load
<code class="docutils literal"><span class="pre">/etc/zm/zmeventnotification.ini</span></code>. If it doesn’t find it, it will
use internal defaults</li>
<li>If you want to override this with another configuration file, use
<code class="docutils literal"><span class="pre">zmeventnotification.pl</span> <span class="pre">--config</span> <span class="pre">/path/to/your/config/filename.ini</span></code>.</li>
<li>Its always a good idea to validate you config settings. For example:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">zmeventnotification</span><span class="o">.</span><span class="n">pl</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">config</span>

<span class="mi">03</span><span class="o">/</span><span class="mi">31</span><span class="o">/</span><span class="mi">2018</span> <span class="mi">16</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mf">23.231955</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">29790</span><span class="p">]</span><span class="o">.</span><span class="n">INF</span> <span class="p">[</span><span class="n">using</span> <span class="n">config</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">zm</span><span class="o">/</span><span class="n">zmeventnotification</span><span class="o">.</span><span class="n">ini</span><span class="p">]</span>
<span class="n">Configuration</span> <span class="p">(</span><span class="n">read</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">zm</span><span class="o">/</span><span class="n">zmeventnotification</span><span class="o">.</span><span class="n">ini</span><span class="p">):</span>

<span class="n">Port</span> <span class="o">..........................</span> <span class="mi">9000</span>
<span class="n">Address</span> <span class="o">.......................</span> <span class="n">XX</span><span class="o">.</span><span class="n">XX</span><span class="o">.</span><span class="n">XX</span><span class="o">.</span><span class="n">XX</span>
<span class="n">Event</span> <span class="n">check</span> <span class="n">interval</span> <span class="o">..........</span> <span class="mi">5</span>
<span class="n">Monitor</span> <span class="n">reload</span> <span class="n">interval</span> <span class="o">.......</span> <span class="mi">300</span>

<span class="n">Auth</span> <span class="n">enabled</span> <span class="o">..................</span> <span class="n">true</span>
<span class="n">Auth</span> <span class="n">timeout</span> <span class="o">..................</span> <span class="mi">20</span>

<span class="n">Use</span> <span class="n">FCM</span> <span class="o">.......................</span> <span class="n">true</span>
<span class="n">FCM</span> <span class="n">API</span> <span class="n">key</span> <span class="o">...................</span> <span class="p">(</span><span class="n">defined</span><span class="p">)</span>
<span class="n">Token</span> <span class="n">file</span> <span class="o">....................</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">zmeventnotification</span><span class="o">/</span><span class="n">push</span><span class="o">/</span><span class="n">tokens</span><span class="o">.</span><span class="n">txt</span>

<span class="n">SSL</span> <span class="n">enabled</span> <span class="o">...................</span> <span class="n">true</span>
<span class="n">SSL</span> <span class="n">cert</span> <span class="n">file</span> <span class="o">.................</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">zm</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">zoneminder</span><span class="o">.</span><span class="n">crt</span>
<span class="n">SSL</span> <span class="n">key</span> <span class="n">file</span> <span class="o">..................</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">zm</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">zoneminder</span><span class="o">.</span><span class="n">key</span>

<span class="n">Verbose</span> <span class="o">.......................</span> <span class="n">false</span>
<span class="n">Read</span> <span class="n">alarm</span> <span class="n">cause</span> <span class="o">..............</span> <span class="n">true</span>
<span class="n">Tag</span> <span class="n">alarm</span> <span class="n">event</span> <span class="nb">id</span> <span class="o">............</span> <span class="n">false</span>
<span class="n">Use</span> <span class="n">custom</span> <span class="n">notification</span> <span class="n">sound</span> <span class="o">.</span> <span class="n">false</span>

<span class="n">Hook</span> <span class="o">..........................</span> <span class="s1">&#39;/usr/bin/person_detect_wrapper.sh&#39;</span>
<span class="n">Use</span> <span class="n">Hook</span> <span class="n">Description</span><span class="o">...........</span> <span class="n">true</span>
</pre></div>
</div>
</div>
<div class="section" id="what-is-the-hook-section">
<h3>What is the hook section ?<a class="headerlink" href="#what-is-the-hook-section" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">hook</span></code> section allows you to invoke a custom script when an alarm
is triggered by ZM.</p>
<p><code class="docutils literal"><span class="pre">hook_script</span></code> points to the script that is invoked when an alarm
occurs</p>
<p>If the script returns success (exit value of 0) then the notification
server will send out an alarm notification. If not, it will not send a
notification to its listeners. This is useful to implement any custom
logic you may want to perform that decides whether this event is worth
sending a notification for.</p>
<p>Related to <code class="docutils literal"><span class="pre">hook</span></code> we also have a <code class="docutils literal"><span class="pre">hook_description</span></code> attribute. When
set to 1, the text returned by the hook script will overwrite the alarm
text that is notified.</p>
<p>We also have a <code class="docutils literal"><span class="pre">skip_monitors</span></code> attribute. This is a comma separated
list of monitors. When alarms occur in those monitors, hooks will not be
called and the ES will directly send out notifications (if enabled in
ES). This is useful when you don’t want to invoke hooks for certain
monitors as they may be expensive (especially if you are doing object
detection)</p>
<p>Finally, <code class="docutils literal"><span class="pre">keep_frame_match_type</span></code> is really used when you enable
“bestmatch”. It prefixes an <code class="docutils literal"><span class="pre">[a]</span></code> or <code class="docutils literal"><span class="pre">[s]</span></code> to tell you if object
detection succeeded in the alarmed or snapshot frame.</p>
<p>Here is an example: (Note: just an example, please don’t ask me for
support for person detection)</p>
<ul class="simple">
<li>You will find a sample <code class="docutils literal"><span class="pre">detect_wrapper.sh</span></code> hook in the <code class="docutils literal"><span class="pre">hook</span></code>
directory. This script is invoked by the notification server when an
event occurs.</li>
<li>This script in turn invokes a python OpenCV based script that grabs
an image with maximum score from the current event so far and runs a
fast person detection routine.</li>
<li>It returns the value “person detected” if a person is found and none
if not</li>
<li>The wrapper script then checks for this value and exits with either 0
(send alarm) or 1 (don’t send alarm)</li>
<li>the notification server then sends out a “: person detected”
notification to the clients listening</li>
</ul>
<p>Those who want to know more: - Read the detailed notes
<a class="reference external" href="https://github.com/pliablepixels/zmeventnotification/tree/master/hook">here</a>
- Read
<a class="reference external" href="https://medium.com/zmninja/inside-the-hood-machine-learning-enhanced-real-time-alarms-with-zoneminder-e26c34fe354c">this</a>
for an explanation of how this works</p>
</div>
</div>
<div class="section" id="troubleshooting-common-situations">
<h2>Troubleshooting common situations<a class="headerlink" href="#troubleshooting-common-situations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="picture-notifications-don-t-show-images">
<h3>Picture notifications don’t show images<a class="headerlink" href="#picture-notifications-don-t-show-images" title="Permalink to this headline">¶</a></h3>
<p>Starting v2.0, I support images in alarms. However, there are several
conditions to be met: * You can’t use self signed certs * The
IP/hostname needs to be publicly accessible (Apple/Google servers render
the image) * You need patches to ZM unless you are using a package that
is later than Oct 11, 2018. Please read the notes in the INI file * A
good way to isolate if its a URL problem or something else is replace
the <code class="docutils literal"><span class="pre">picture_url</span></code> with a knows HTTPS url like
<a class="reference external" href="https://upload.wikimedia.org/wikipedia/commons/5/5f/Chinese_new_year_dragon_2014.jpg">this</a></p>
<p>Before you report issues, please make sure you have been diligent in
testing - Try with a public URL as indicated above. This is important. -
In your issue, post debug logs of zmeventnotification so I can see what
message it is sending</p>
</div>
<div class="section" id="secure-mode-just-doesn-t-work-wss-ws-works">
<h3>Secure mode just doesn’t work (WSS) - WS works<a class="headerlink" href="#secure-mode-just-doesn-t-work-wss-ws-works" title="Permalink to this headline">¶</a></h3>
<p>Try to put in your event server IP in the <code class="docutils literal"><span class="pre">address</span></code> token in
<code class="docutils literal"><span class="pre">[network]</span></code> section of <code class="docutils literal"><span class="pre">zmeventnotification.ini</span></code></p>
</div>
<div class="section" id="i-m-not-receiving-push-notifications-in-zmninja">
<h3>I’m not receiving push notifications in zmNinja<a class="headerlink" href="#i-m-not-receiving-push-notifications-in-zmninja" title="Permalink to this headline">¶</a></h3>
<p>This almost always happens when zmNinja is not able to reach the server.
Before you contact me, please perform the following steps and send me
the output:</p>
<ol class="arabic simple">
<li>Stop the event server. <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">zmdc.pl</span> <span class="pre">stop</span> <span class="pre">zmeventnotification.pl</span></code></li>
<li>Do a <code class="docutils literal"><span class="pre">ps</span> <span class="pre">-aef</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">zmevent</span></code> and make sure no stale processes are
running</li>
<li>Edit your <code class="docutils literal"><span class="pre">/etc/zm/zmeventnotification.ini</span></code> and make sure
<code class="docutils literal"><span class="pre">verbose</span> <span class="pre">=</span> <span class="pre">1</span></code> to get verbose logs</li>
<li>Run the server manually by doing
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">-u</span> <span class="pre">www-data</span> <span class="pre">/usr/bin/zmeventnotification.pl</span></code> (replace with
<code class="docutils literal"><span class="pre">www-data</span></code> with <code class="docutils literal"><span class="pre">apache</span></code> depending on your OS)</li>
<li>You should now see logs on the commandline like so that shows the
server is running:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">08</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">32</span> <span class="n">About</span> <span class="n">to</span> <span class="n">start</span> <span class="n">listening</span> <span class="n">to</span> <span class="n">socket</span>
<span class="mi">12</span><span class="o">/</span><span class="mi">20</span><span class="o">/</span><span class="mi">2018</span> <span class="mi">08</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">32.606198</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">12460</span><span class="p">]</span><span class="o">.</span><span class="n">INF</span> <span class="p">[</span><span class="n">main</span><span class="p">:</span><span class="mi">582</span><span class="p">]</span> <span class="p">[</span><span class="n">About</span> <span class="n">to</span> <span class="n">start</span> <span class="n">listening</span> <span class="n">to</span> <span class="n">socket</span><span class="p">]</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">08</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">32</span> <span class="n">Secure</span> <span class="n">WS</span><span class="p">(</span><span class="n">WSS</span><span class="p">)</span> <span class="ow">is</span> <span class="n">enabled</span><span class="o">...</span>
<span class="mi">12</span><span class="o">/</span><span class="mi">20</span><span class="o">/</span><span class="mi">2018</span> <span class="mi">08</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">32.656834</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">12460</span><span class="p">]</span><span class="o">.</span><span class="n">INF</span> <span class="p">[</span><span class="n">main</span><span class="p">:</span><span class="mi">582</span><span class="p">]</span> <span class="p">[</span><span class="n">Secure</span> <span class="n">WS</span><span class="p">(</span><span class="n">WSS</span><span class="p">)</span> <span class="ow">is</span> <span class="n">enabled</span><span class="o">...</span><span class="p">]</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">08</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">32</span> <span class="n">Web</span> <span class="n">Socket</span> <span class="n">Event</span> <span class="n">Server</span> <span class="n">listening</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">9000</span>
<span class="mi">12</span><span class="o">/</span><span class="mi">20</span><span class="o">/</span><span class="mi">2018</span> <span class="mi">08</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">32.696406</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">12460</span><span class="p">]</span><span class="o">.</span><span class="n">INF</span> <span class="p">[</span><span class="n">main</span><span class="p">:</span><span class="mi">582</span><span class="p">]</span> <span class="p">[</span><span class="n">Web</span> <span class="n">Socket</span> <span class="n">Event</span> <span class="n">Server</span> <span class="n">listening</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">9000</span><span class="p">]</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li>Now start zmNinja. You should see event server logs like this:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">08</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">43</span> <span class="n">Raw</span> <span class="n">incoming</span> <span class="n">message</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;event&quot;</span><span class="p">:</span><span class="s2">&quot;push&quot;</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">:{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;token&quot;</span><span class="p">,</span><span class="s2">&quot;platform&quot;</span><span class="p">:</span><span class="s2">&quot;ios&quot;</span><span class="p">,</span><span class="s2">&quot;token&quot;</span><span class="p">:</span><span class="s2">&quot;cVuLzCBsEn4:APA91bHYuO3hVJqTIMsm0IRNQEYAUa&lt;deleted&gt;GYBwNdwRfKyZV0&quot;</span><span class="p">,</span><span class="s2">&quot;monlist&quot;</span><span class="p">:</span><span class="s2">&quot;1,2,4,5,6,7,11&quot;</span><span class="p">,</span><span class="s2">&quot;intlist&quot;</span><span class="p">:</span><span class="s2">&quot;45,60,0,0,0,45,45&quot;</span><span class="p">,</span><span class="s2">&quot;state&quot;</span><span class="p">:</span><span class="s2">&quot;enabled&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>If you don’t see these logs on the event server, zmNinja is not able to
connect to the event server. This may be because of several reasons: a)
Your event server IP/DNS is not reachable from your phone b) If you are
using SSL, your certificates are invalid (try disabling SSL first - both
on the event server and on zmNinja) c) Your zmNinja configuration is
wrong (the most common error I see is the server has SSL disabled, but
zmNinja is configured to use <code class="docutils literal"><span class="pre">wss://</span></code> instead of <code class="docutils literal"><span class="pre">ws://</span></code>)</p>
<ol class="arabic simple" start="7">
<li>Assuming the above worked, go to zmNinja logs in the app. Somewhere
in the logs, you should see a line similar to:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Dec</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2018</span> <span class="mi">05</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">41</span> <span class="n">AM</span> <span class="n">DEBUG</span> <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">event</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;version&quot;</span><span class="p">:</span><span class="s2">&quot;2.4&quot;</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="p">:</span><span class="s2">&quot;Success&quot;</span><span class="p">,</span><span class="s2">&quot;reason&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;event&quot;</span><span class="p">:</span><span class="s2">&quot;auth&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the event server successfully authenticated the app.
If you see step 6 work but not step 7, you might have provided incorrect
credentials (and in that case, you’ll see an error message)</p>
<ol class="arabic simple" start="8">
<li>Finally, after all of the above succeeds, do a
<code class="docutils literal"><span class="pre">cat</span> <span class="pre">/var/lib/zmeventnotification/push/tokens.txt</span></code> to make sure
the device token that zmNinja sent is stored (desktop apps don’t
have a device token). If you are using zmNinja on a mobile app, and
you don’t see an entry in <code class="docutils literal"><span class="pre">tokens.txt</span></code> you have a problem. Debug.</li>
<li><em>Always</em> send me logs of both zmNinja and zmeventnotification - I
need them to understand what is going on. Don’t send me one line.
You may think you are sending what is relevant, but you are not. One
line logs are mostly useless.</li>
<li>Some other notes:</li>
</ol>
<ul class="simple">
<li>If you don’t see an entry in <code class="docutils literal"><span class="pre">tokens.txt</span></code> (typically in
<code class="docutils literal"><span class="pre">/var/lib/zmeventnotification/push</span></code>) then your phone is not
registered to get push. Kill zmNinja, start the app, make sure the
event server receives the registration and check <code class="docutils literal"><span class="pre">tokens.txt</span></code></li>
<li>Sometimes, Google’s FCM server goes down, or Apple’s APNS server goes
down for a while. Things automagically work in 24 hrs.</li>
<li>Kill the app. Then empty the contents of <code class="docutils literal"><span class="pre">tokens.txt</span></code> in the event
server (don’t delete it). Then restart the event server. Start the
app again. If you don’t see a new registration token, you have a
connection problem</li>
<li>I’d strongly recommend you run the event server in “manual mode” and
stop daemon mode while debugging.</li>
</ul>
</div>
<div class="section" id="i-m-getting-multiple-notifications-for-the-same-event">
<h3>I’m getting multiple notifications for the same event<a class="headerlink" href="#i-m-getting-multiple-notifications-for-the-same-event" title="Permalink to this headline">¶</a></h3>
<p>99.9% of times, its because you have multiple copies of the eventserver
running and you don’t know it. Maybe you were manually testing it, and
forgot to quit it and terminated the window. Do
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">zmdc.pl</span> <span class="pre">stop</span> <span class="pre">zmeventnotification.pl</span></code> and then
<code class="docutils literal"><span class="pre">ps</span> <span class="pre">-aef</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">zme</span></code>, kill everything, and start again. Monitor the
logs to see how many times a message is sent out.</p>
<p>The other 0.1% is at times Google’s FCM servers send out multiple
notifications. Why? I don’t know. But it sorts itself out very quickly,
and if you think this must be the reason, I’ll wager that you are
actually in the 99.9% lot and haven’t checked properly.</p>
</div>
<div class="section" id="the-server-runs-fine-when-manually-executed-but-fails-when-run-in-daemon-mode-started-by-zmdc-pl">
<h3>The server runs fine when manually executed, but fails when run in daemon mode (started by zmdc.pl)<a class="headerlink" href="#the-server-runs-fine-when-manually-executed-but-fails-when-run-in-daemon-mode-started-by-zmdc-pl" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make sure the file where you store tokens
(<code class="docutils literal"><span class="pre">/var/lib/zmeventnotification/push/tokens.txt</span> <span class="pre">or</span> <span class="pre">whatever</span> <span class="pre">you</span> <span class="pre">have</span> <span class="pre">used</span></code>)
is not RW Root only. It needs to be RW <code class="docutils literal"><span class="pre">www-data</span></code> for Ubuntu/Debian
or <code class="docutils literal"><span class="pre">apache</span></code> for Fedora/CentOS. You also need to make sure the
directory is accessible. Something like
<code class="docutils literal"><span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">www-data:www-data</span> <span class="pre">/var/lib/zmeventnotification/push</span></code></li>
<li>Make sure your certificates are readable by <code class="docutils literal"><span class="pre">www-data</span></code> for
Ubuntu/Debian, or <code class="docutils literal"><span class="pre">apache</span></code> for Fedora/CentOS (thanks to
[&#64;jagee](<a class="reference external" href="https://github.com/pliablepixels/zmeventnotification/issues/8">https://github.com/pliablepixels/zmeventnotification/issues/8</a>))</li>
<li>Make sure the <em>path</em> to the certificates are readable by <code class="docutils literal"><span class="pre">www-data</span></code>
for Ubuntu/Debian, or <code class="docutils literal"><span class="pre">apache</span></code> for Fedora/CentOS</li>
</ul>
</div>
<div class="section" id="when-you-run-zmeventnotifiation-pl-manually-you-get-an-error-saying-port-already-in-use-or-cannot-bind-to-port-or-something-like-that">
<h3>When you run zmeventnotifiation.pl manually, you get an error saying ‘port already in use’ or ‘cannot bind to port’ or something like that<a class="headerlink" href="#when-you-run-zmeventnotifiation-pl-manually-you-get-an-error-saying-port-already-in-use-or-cannot-bind-to-port-or-something-like-that" title="Permalink to this headline">¶</a></h3>
<p>The chances are very high that you have another copy of
<code class="docutils literal"><span class="pre">zmeventnotification.pl</span></code> running. You might have run it in daemon
mode. Try <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">zmdc.pl</span> <span class="pre">stop</span> <span class="pre">zmeventnotification.pl</span></code>. Also do
<code class="docutils literal"><span class="pre">ps</span> <span class="pre">-aef</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">zmeventnotification</span></code> to check if another copy is not
running and if you do find one running, you’ll have to kill it before
you can start it from command line again.</p>
</div>
<div class="section" id="great-krypton-i-just-upgraded-zoneminder-and-i-m-not-getting-push-anymore">
<h3>Great Krypton! I just upgraded ZoneMinder and I’m not getting push anymore!<a class="headerlink" href="#great-krypton-i-just-upgraded-zoneminder-and-i-m-not-getting-push-anymore" title="Permalink to this headline">¶</a></h3>
<p>Make sure your eventserver is running:
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">zmdc.pl</span> <span class="pre">status</span> <span class="pre">zmeventnotification.pl</span></code></p>
</div>
</div>
<div class="section" id="how-do-i-disable-secure-wss-mode">
<h2>How do I disable secure (WSS) mode?<a class="headerlink" href="#how-do-i-disable-secure-wss-mode" title="Permalink to this headline">¶</a></h2>
<p>As it turns out many folks run ZM inside the LAN only and don’t want to
deal with certificates. Fair enough. For that situation, edit
zmeventnotification.pl and use <code class="docutils literal"><span class="pre">enable</span> <span class="pre">=</span> <span class="pre">0</span></code> in the <code class="docutils literal"><span class="pre">[ssl]</span></code> section
of the configuration file. <strong>Remember to ensure that your EventServer
URL in zmNinja does NOT use wss too - change it to ws</strong></p>
</div>
<div class="section" id="debugging-and-reporting-problems">
<h2>Debugging and reporting problems<a class="headerlink" href="#debugging-and-reporting-problems" title="Permalink to this headline">¶</a></h2>
<p>STOP. Before you shoot me an email, <strong>please</strong> make sure you have read
the <a class="reference external" href="#troubleshooting-common-situations">common problems</a> and have
followed <em>every step</em> of the <a class="reference external" href="#how-do-i-install-it">install guide</a>
and in sequence. I can’t emphasize how important it is.</p>
<p>There could be several reasons why you may not be receiving
notifications:</p>
<ul class="simple">
<li>Your event server is not running</li>
<li>Your app is not able to reach the server</li>
<li>You have enabled SSL but the certificate is invalid</li>
<li>The event server is rejecting the connections</li>
</ul>
<p>Here is how to debug and report:</p>
<ul class="simple">
<li>Enable Debug logs in zmNinja (Setting-&gt;Developer Options-&gt;Enable
Debug Log)</li>
<li>telnet/ssh into your zoneminder server</li>
<li>Stop the zmeventnotification doing
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">zmdc.pl</span> <span class="pre">stop</span> <span class="pre">zmeventnotification.pl</span></code></li>
<li>Make sure there are no stale processes running of zmeventnotification
by doing <code class="docutils literal"><span class="pre">ps</span> <span class="pre">-aef</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">zmeventnotification</span></code> and making sure it
doesn’t show existing processes (ignore the one that says
<code class="docutils literal"><span class="pre">grep</span> <span class="pre">&lt;something&gt;</span></code>)</li>
<li>Edit <code class="docutils literal"><span class="pre">zmeventnotification.ini</span></code> (typically in <code class="docutils literal"><span class="pre">/etc/zm/</span></code>) and make
sure <code class="docutils literal"><span class="pre">verbose</span> <span class="pre">=</span> <span class="pre">1</span></code> is set. This will print more logs on the
console. Make sure you turn this off again before switching back to
daemon mode.</li>
<li>Start a terminal (lets call it Terminal-Log) to tail logs like so
<code class="docutils literal"><span class="pre">tail</span> <span class="pre">-f</span> <span class="pre">/var/log/syslog</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">zmeventnotification</span></code></li>
<li>Start another terminal and start zmeventnotification manually from
command line like so <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">/usr/bin/zmeventnotification.pl</span></code></li>
<li>Make sure you see logs like this in the logs window like so:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Nov</span> <span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">20</span> <span class="n">homeserver</span> <span class="n">zmdc</span><span class="p">[</span><span class="mi">18560</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="s1">&#39;zmeventnotification.pl&#39;</span> <span class="n">started</span> <span class="n">at</span> <span class="mi">17</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
<span class="n">Nov</span> <span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">20</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">18560</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Push</span> <span class="n">enabled</span> <span class="n">via</span> <span class="n">FCM</span><span class="p">]</span>
<span class="n">Nov</span> <span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">20</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">18560</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Event</span> <span class="n">Notification</span> <span class="n">daemon</span> <span class="n">v</span> <span class="mf">0.95</span> <span class="n">starting</span><span class="p">]</span>
<span class="n">Nov</span> <span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">20</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">18560</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Total</span> <span class="n">event</span> <span class="n">client</span> <span class="n">connections</span><span class="p">:</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">Nov</span> <span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">20</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">18560</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Reloading</span> <span class="n">Monitors</span><span class="o">...</span><span class="p">]</span>
<span class="n">Nov</span> <span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">21</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">18560</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Loading</span> <span class="n">monitors</span><span class="p">]</span>
<span class="n">Nov</span> <span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">21</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">18560</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">About</span> <span class="n">to</span> <span class="n">start</span> <span class="n">listening</span> <span class="n">to</span> <span class="n">socket</span><span class="p">]</span>
<span class="n">Nov</span> <span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">21</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">18560</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Secure</span> <span class="n">WS</span><span class="p">(</span><span class="n">WSS</span><span class="p">)</span> <span class="ow">is</span> <span class="n">enabled</span><span class="o">...</span><span class="p">]</span>
<span class="n">Nov</span> <span class="mi">26</span> <span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">21</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">18560</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Web</span> <span class="n">Socket</span> <span class="n">Event</span> <span class="n">Server</span> <span class="n">listening</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">9000</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li>Open up zmNinja, clear logs</li>
<li>Enable event server in zmNinja</li>
<li>Check that when you save the event server connections in zmNinja, you
see logs in the log window like this</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">18</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">got</span> <span class="n">a</span> <span class="n">websocket</span> <span class="n">connection</span> <span class="kn">from</span> <span class="nn">XX.XX.XX.XX</span> <span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">active</span> <span class="n">connections</span><span class="p">]</span>
<span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">18</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Websockets</span><span class="p">:</span> <span class="n">New</span> <span class="n">Connection</span> <span class="n">Handshake</span> <span class="n">requested</span> <span class="kn">from</span> <span class="nn">XX.XX.XX.XX</span><span class="p">:</span><span class="mi">55189</span> <span class="n">state</span><span class="o">=</span><span class="n">pending</span> <span class="n">auth</span><span class="p">]</span>
<span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">18</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Correct</span> <span class="n">authentication</span> <span class="n">provided</span> <span class="n">byXX</span><span class="o">.</span><span class="n">XX</span><span class="o">.</span><span class="n">XX</span><span class="o">.</span><span class="n">XX</span><span class="p">]</span>
<span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">18</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Storing</span> <span class="n">token</span> <span class="o">...</span><span class="mi">9</span><span class="n">f665f182b</span><span class="p">,</span><span class="n">monlist</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">intlist</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">pushstate</span><span class="p">:</span><span class="n">enabled</span><span class="p">]</span>
<span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">19</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Contrl</span><span class="p">:</span> <span class="n">Storing</span> <span class="n">token</span> <span class="o">...</span><span class="mi">9</span><span class="n">f665f182b</span><span class="p">,</span><span class="n">monlist</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">intlist</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">pushstate</span><span class="p">:</span><span class="n">enabled</span><span class="p">]</span>
</pre></div>
</div>
<p>If you don’t see anything there is a connection problem. Review SSL
guidelines above, or temporarily turn off websocket SSL as described
above</p>
<ul class="simple">
<li>Open up ZM console and force an alarm, you should see logs in your
log window above like so:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">55</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">New</span> <span class="n">event</span> <span class="mi">32910</span> <span class="n">reported</span> <span class="k">for</span> <span class="n">Garage</span><span class="p">]</span>
<span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">55</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Broadcasting</span> <span class="n">new</span> <span class="n">events</span> <span class="n">to</span> <span class="nb">all</span> <span class="mi">12</span> <span class="n">websocket</span> <span class="n">clients</span><span class="p">]</span>
<span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">55</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Checking</span> <span class="n">alarm</span> <span class="n">rules</span> <span class="k">for</span>  <span class="n">token</span> <span class="n">ending</span> <span class="ow">in</span><span class="p">:</span><span class="o">...</span><span class="mi">2</span><span class="n">baa57e387</span><span class="p">]</span>
<span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">55</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Monitor</span> <span class="mi">1</span> <span class="n">event</span><span class="p">:</span> <span class="n">last</span> <span class="n">time</span> <span class="ow">not</span> <span class="n">found</span><span class="p">,</span> <span class="n">so</span> <span class="n">sending</span><span class="p">]</span>
<span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">55</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Sending</span> <span class="n">notification</span> <span class="n">over</span> <span class="n">PushProxy</span><span class="p">]</span>
<span class="n">Oct</span> <span class="mi">20</span> <span class="mi">10</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">56</span> <span class="n">homeserver</span> <span class="n">zmeventnotification</span><span class="p">[</span><span class="mi">27789</span><span class="p">]:</span> <span class="n">INF</span> <span class="p">[</span><span class="n">Pushproxy</span> <span class="n">push</span> <span class="n">message</span> <span class="n">success</span> <span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li>If you are debugging problems with receiving push notifications on
zmNinja mobile, then replicate the following scenario:</li>
<li>Run the event server in manual mode as described above</li>
<li>Kill zmNinja</li>
<li>Start zmNinja</li>
<li>At this point, in the <code class="docutils literal"><span class="pre">zmeventnotification</span></code> logs you should
registration messages (refer to logs example above). If you don’t
you’ve either not configured zmNinja to use the eventserver, or it
can’t reach the eventserver (very common problem)</li>
<li>Next up, make sure you are not running zmNinja in the foreground
(move it to background or kill it). When zmNinja is in the
foreground, it uses websockets to get notifications</li>
<li>Force an alarm like I described above. If you don’t see logs in
<code class="docutils literal"><span class="pre">zmeventnotification</span></code> saying “Sending notification over PushProxy”
then the eventserver, for some reason, does not have your app token.
Inspeced <code class="docutils literal"><span class="pre">tokens.txt</span></code> (typically in <code class="docutils literal"><span class="pre">/etc/zm/</span></code>) to make sure an
entry for your phone exists</li>
<li>If you see that message, but your mobile phone is not receiving a
push notification:</li>
<li>Make sure you haven’t disable push notifications on your phone (lots
of people do this by mistake and wonder why)</li>
<li>Make sure you haven’t muted notifications (again, lots of people…)</li>
<li>Sometimes, the push servers of Apple and Google stop forwarding
messages for a day or two. I have no idea why. Give it a day or two?</li>
<li>Open up zmNinja, go right to logs and send it to me</li>
<li>If you have issues, please send me a copy of your zmeventnotification
logs generated above from Terminal-Log, as well as zmNinja debug logs</li>
</ul>
</div>
<div class="section" id="how-scalable-is-it">
<h2>How scalable is it?<a class="headerlink" href="#how-scalable-is-it" title="Permalink to this headline">¶</a></h2>
<p>It’s a lightweight single threaded process. I really don’t see a need
for launching a zillion threads or a process per monitor etc for what it
does. I’d argue its simplicity is its scalability. Plus I don’t expect
more than a handful of consumers to connect to it. I really don’t see
why it won’t be able to scale to for what is does. But if you are facing
scalability issues, let me know. There is
<a class="reference external" href="http://mojolicio.us/">Mojolicious</a> I can use to make it more
scalable if I am proven wrong about scalability.</p>
</div>
<div class="section" id="brickbats">
<h2>Brickbats<a class="headerlink" href="#brickbats" title="Permalink to this headline">¶</a></h2>
<p><strong>Why not just supply the username and password in the URL as a
resource? It’s over TLS</strong></p>
<p>Yup its encrypted but it may show up in the history of a browser you
tried it from (if you are using a browser) Plus it may get passed along
from the source when accessing another URL via the Referral header</p>
<p><strong>So it’s encrypted, but passing password is a bad idea. Why not some
token?</strong></p>
<ul class="simple">
<li>Too much work.</li>
<li>Plus I’m an unskilled programmer. Pull Requests welcome</li>
</ul>
<p><strong>Why WSS and not WS?</strong></p>
<p>Not secure. Easy to snoop. Updated: As of 0.6, I’ve also added a non
secure version - use <code class="docutils literal"><span class="pre">enable</span> <span class="pre">=</span> <span class="pre">0</span></code> in the <code class="docutils literal"><span class="pre">[ssl]</span></code> section of the
configuration file. As it turns out many folks don’t expose ZM to the
WAN and for that, I guess WS instead of WSS is ok.</p>
<p><strong>Why ZM auth in addition to WSS?</strong></p>
<p>WSS offers encryption. We also want to make sure connections are
authorized. Reusing ZM authentication credentials is the easiest. You
can change it to some other credential match (modify <code class="docutils literal"><span class="pre">validateZM</span></code>
function)</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="developers.html" class="btn btn-neutral float-right" title="For Developers writing their own consumers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="breaking.html" class="btn btn-neutral" title="Breaking Changes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Pliable Pixels.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>